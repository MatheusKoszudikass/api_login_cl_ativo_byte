---
deployment:
  tasks:
    # Definir o caminho do deploy
    - export DEPLOYPATH=/home/ativobyt/api.cliente.ativobyte.com.br/

    # Copiar arquivos de configuração
    - /bin/cp .env $DEPLOYPATH
    - /bin/cp .htaccess $DEPLOYPATH
    - /bin/cp composer.json $DEPLOYPATH
    - /bin/cp composer.lock $DEPLOYPATH
    - /bin/cp symfony.lock $DEPLOYPATH

    # Copiar diretórios
    - /bin/cp -R bin $DEPLOYPATH
    - /bin/cp -R migrations $DEPLOYPATH
    - /bin/cp -R config $DEPLOYPATH
    - /bin/cp -R public $DEPLOYPATH
    - /bin/cp -R src $DEPLOYPATH
    - /bin/cp -R var $DEPLOYPATH

    # Atualizar dependências do Composer
    - cd $DEPLOYPATH && composer install --no-dev --optimize-autoloader

    # Limpar e aquecer o cache do Symfony
    - cd $DEPLOYPATH && php bin/console cache:clear --env=prod --no-warmup
    - cd $DEPLOYPATH && php bin/console cache:warmup --env=prod

